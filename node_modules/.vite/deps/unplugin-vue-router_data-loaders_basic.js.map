{
  "version": 3,
  "sources": ["../../unplugin-vue-router/dist/data-loaders/basic.js"],
  "sourcesContent": ["import {\r\n  toLazyValue\r\n} from \"./chunk-4MKZ4JDN.js\";\r\n\r\n// src/data-loaders/defineLoader.ts\r\nimport {\r\n  useRoute,\r\n  useRouter\r\n} from \"vue-router\";\r\nimport {\r\n  ABORT_CONTROLLER_KEY,\r\n  APP_KEY,\r\n  IS_USE_DATA_LOADER_KEY,\r\n  LOADER_ENTRIES_KEY,\r\n  NAVIGATION_RESULTS_KEY,\r\n  PENDING_LOCATION_KEY,\r\n  STAGED_NO_VALUE,\r\n  NavigationResult,\r\n  getCurrentContext,\r\n  setCurrentContext,\r\n  IS_SSR_KEY\r\n} from \"unplugin-vue-router/data-loaders\";\r\nimport { shallowRef } from \"vue\";\r\nfunction defineBasicLoader(nameOrLoader, _loaderOrOptions, opts) {\r\n  const loader = typeof nameOrLoader === \"function\" ? nameOrLoader : _loaderOrOptions;\r\n  opts = typeof _loaderOrOptions === \"object\" ? _loaderOrOptions : opts;\r\n  const options = {\r\n    ...DEFAULT_DEFINE_LOADER_OPTIONS,\r\n    ...opts,\r\n    // avoid opts overriding with `undefined`\r\n    commit: opts?.commit || DEFAULT_DEFINE_LOADER_OPTIONS.commit\r\n  };\r\n  function load(to, router, from, parent) {\r\n    const entries = router[LOADER_ENTRIES_KEY];\r\n    const isSSR = router[IS_SSR_KEY];\r\n    if (!entries.has(loader)) {\r\n      entries.set(loader, {\r\n        // force the type to match\r\n        data: shallowRef(),\r\n        isLoading: shallowRef(false),\r\n        error: shallowRef(),\r\n        to,\r\n        options,\r\n        children: /* @__PURE__ */ new Set(),\r\n        resetPending() {\r\n          this.pendingLoad = null;\r\n          this.pendingTo = null;\r\n        },\r\n        pendingLoad: null,\r\n        pendingTo: null,\r\n        staged: STAGED_NO_VALUE,\r\n        stagedError: null,\r\n        commit\r\n      });\r\n    }\r\n    const entry = entries.get(loader);\r\n    if (entry.pendingTo === to && entry.pendingLoad) {\r\n      return entry.pendingLoad;\r\n    }\r\n    const { error, isLoading, data } = entry;\r\n    const initialRootData = router[INITIAL_DATA_KEY];\r\n    const key = options.key || \"\";\r\n    let initialData = STAGED_NO_VALUE;\r\n    if (initialRootData && key in initialRootData) {\r\n      initialData = initialRootData[key];\r\n      delete initialRootData[key];\r\n    }\r\n    if (initialData !== STAGED_NO_VALUE) {\r\n      data.value = initialData;\r\n      return entry.pendingLoad = Promise.resolve();\r\n    }\r\n    entry.pendingTo = to;\r\n    isLoading.value = true;\r\n    const currentContext = getCurrentContext();\r\n    if (process.env.NODE_ENV === \"development\") {\r\n      if (parent !== currentContext[0]) {\r\n        console.warn(\r\n          `\\u274C\\u{1F476} \"${options.key}\" has a different parent than the current context. This shouldn't be happening. Please report a bug with a reproduction to https://github.com/posva/unplugin-vue-router/`\r\n        );\r\n      }\r\n    }\r\n    setCurrentContext([entry, router, to]);\r\n    entry.staged = STAGED_NO_VALUE;\r\n    entry.stagedError = error.value;\r\n    const currentLoad = Promise.resolve(\r\n      loader(to, { signal: to.meta[ABORT_CONTROLLER_KEY]?.signal })\r\n    ).then((d) => {\r\n      if (entry.pendingLoad === currentLoad) {\r\n        if (d instanceof NavigationResult) {\r\n          to.meta[NAVIGATION_RESULTS_KEY].push(d);\r\n        } else {\r\n          entry.staged = d;\r\n          entry.stagedError = null;\r\n        }\r\n      }\r\n    }).catch((e) => {\r\n      if (entry.pendingLoad === currentLoad) {\r\n        entry.stagedError = e;\r\n        if (!toLazyValue(options.lazy, to, from) || isSSR) {\r\n          throw e;\r\n        }\r\n      }\r\n    }).finally(() => {\r\n      setCurrentContext(currentContext);\r\n      if (entry.pendingLoad === currentLoad) {\r\n        isLoading.value = false;\r\n        if (options.commit === \"immediate\" || // outside of navigation\r\n        !router[PENDING_LOCATION_KEY]) {\r\n          entry.commit(to);\r\n        }\r\n      } else {\r\n      }\r\n    });\r\n    setCurrentContext(currentContext);\r\n    entry.pendingLoad = currentLoad;\r\n    return currentLoad;\r\n  }\r\n  function commit(to) {\r\n    if (this.pendingTo === to) {\r\n      if (process.env.NODE_ENV === \"development\") {\r\n        if (this.staged === STAGED_NO_VALUE) {\r\n          console.warn(\r\n            `Loader \"${options.key}\"'s \"commit()\" was called but there is no staged data.`\r\n          );\r\n        }\r\n      }\r\n      if (this.staged !== STAGED_NO_VALUE) {\r\n        this.data.value = this.staged;\r\n      }\r\n      this.error.value = this.stagedError;\r\n      this.staged = STAGED_NO_VALUE;\r\n      this.stagedError = this.error.value;\r\n      this.pendingTo = null;\r\n      this.to = to;\r\n      for (const childEntry of this.children) {\r\n        childEntry.commit(to);\r\n      }\r\n    }\r\n  }\r\n  const useDataLoader = () => {\r\n    const currentContext = getCurrentContext();\r\n    const [parentEntry, _router, _route] = currentContext;\r\n    const router = _router || useRouter();\r\n    const route = _route || useRoute();\r\n    const entries = router[LOADER_ENTRIES_KEY];\r\n    let entry = entries.get(loader);\r\n    if (\r\n      // if the entry doesn't exist, create it with load and ensure it's loading\r\n      !entry || // the existing pending location isn't good, we need to load again\r\n      parentEntry && entry.pendingTo !== route || // we could also check for: but that would break nested loaders since they need to be always called to be associated with the parent\r\n      // && entry.to !== route\r\n      // the user managed to render the router view after a valid navigation + a failed navigation\r\n      // https://github.com/posva/unplugin-vue-router/issues/495\r\n      !entry.pendingLoad\r\n    ) {\r\n      router[APP_KEY].runWithContext(\r\n        () => load(route, router, void 0, parentEntry)\r\n      );\r\n    }\r\n    entry = entries.get(loader);\r\n    if (parentEntry) {\r\n      if (parentEntry === entry) {\r\n        console.warn(\r\n          `\\u{1F476}\\u274C \"${options.key}\" has itself as parent. This shouldn't be happening. Please report a bug with a reproduction to https://github.com/posva/unplugin-vue-router/`\r\n        );\r\n      }\r\n      parentEntry.children.add(entry);\r\n    }\r\n    const { data, error, isLoading } = entry;\r\n    const useDataLoaderResult = {\r\n      data,\r\n      error,\r\n      isLoading,\r\n      reload: (to = router.currentRoute.value) => router[APP_KEY].runWithContext(() => load(to, router)).then(\r\n        () => entry.commit(to)\r\n      )\r\n    };\r\n    const promise = entry.pendingLoad.then(() => {\r\n      return entry.staged === STAGED_NO_VALUE ? data.value : entry.staged;\r\n    }).catch((e) => parentEntry ? Promise.reject(e) : null);\r\n    setCurrentContext(currentContext);\r\n    return Object.assign(promise, useDataLoaderResult);\r\n  };\r\n  useDataLoader[IS_USE_DATA_LOADER_KEY] = true;\r\n  useDataLoader._ = {\r\n    load,\r\n    options,\r\n    // @ts-expect-error: return type has the generics\r\n    getEntry(router) {\r\n      return router[LOADER_ENTRIES_KEY].get(loader);\r\n    }\r\n  };\r\n  return useDataLoader;\r\n}\r\nvar DEFAULT_DEFINE_LOADER_OPTIONS = {\r\n  lazy: false,\r\n  server: true,\r\n  commit: \"after-load\"\r\n};\r\nvar SERVER_INITIAL_DATA_KEY = Symbol();\r\nvar INITIAL_DATA_KEY = Symbol();\r\nexport {\r\n  defineBasicLoader\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
